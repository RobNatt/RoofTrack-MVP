{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rober/OneDrive/Desktop/web%20dev%20projects/Roof-Track/src/app/signup/page.tsx"],"sourcesContent":["'use client';\r\nimport { useState } from 'react';\r\nimport { createClient } from '@/lib/supabase/client';\r\nimport { useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\n\r\nexport default function SignupPage() {\r\n    const router = useRouter();\r\n    const [formData, setFormData] = useState({\r\n        fullName: '',\r\n        phoneNumber: '',\r\n        companyName: '',\r\n        email: '',\r\n        password: ''\r\n    });\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState('');\r\n\r\n    const handleSignup = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n        setError('');\r\n\r\n        const supabase = createClient();\r\n        try {\r\n            // 1. Create auth user\r\n            const { data: authData, error: authError } = await supabase.auth.signUp({\r\n                email: formData.email,\r\n                password: formData.password,\r\n            });\r\n\r\n            if (authError) throw authError;\r\n            if (!authData.user) throw new Error('No user returned');\r\n\r\n            // 2. Create or get company\r\n            let companyId;\r\n            const { data: existingCompany } = await supabase\r\n                .from('companies')\r\n                .select('id')\r\n                .eq('name', formData.companyName)\r\n                .single();\r\n\r\n            if (existingCompany) {\r\n                companyId = existingCompany.id;\r\n            } else {\r\n                const { data: newCompany, error: companyError } = await supabase\r\n                    .from('companies')\r\n                    .insert([{ name: formData.companyName }])\r\n                    .select()\r\n                    .single();\r\n\r\n                if (companyError) throw companyError;\r\n                companyId = newCompany.id;\r\n            }\r\n\r\n            // 3. Create profile\r\n            const { error: profileError } = await supabase\r\n                .from('profiles')\r\n                .insert([{\r\n                    id: authData.user.id,\r\n                    company_id: companyId,\r\n                    full_name: formData.fullName,\r\n                    role: 'rep'\r\n                }]);\r\n\r\n            if (profileError) throw profileError;\r\n\r\n            // 4. Success! Redirect to dashboard\r\n            router.push('/dashboard');\r\n            router.refresh();\r\n\r\n        } catch (err: unknown) {\r\n            setError(err instanceof Error ? err.message : 'An error occurred during signup');\r\n            console.error('Signup error:', err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <main className=\"flex flex-col items-center justify-center min-h-screen py-2\">\r\n            <div className=\"p-6 bg-gray-100 rounded-2xl shadow-2xl\">\r\n                <h1 className=\"text-4xl font-bold mb-8\">Signup Page</h1>\r\n                <form onSubmit={handleSignup} className=\"text-lg gap-4 space-y-4\">\r\n                    {error && <p className=\"text-red-600 text-sm mb-2\">{error}</p>}\r\n                    <div>\r\n                        <label className=\"block\">Full Name</label>\r\n                        <input type=\"text\"\r\n                        value={formData.fullName}\r\n                        onChange={(e) => setFormData({ ...formData, fullName: e.target.value })}\r\n                        className=\"p-3 border rounded-lg\"/>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block\">Phone Number</label>\r\n                        <input type=\"tel\"\r\n                        value={formData.phoneNumber}\r\n                        onChange={(e) => setFormData({ ...formData, phoneNumber: e.target.value })}\r\n                        className=\"p-3 border rounded-lg\"/>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block\">Company Name</label>\r\n                        <input type=\"text\"\r\n                        value={formData.companyName}\r\n                        onChange={(e) => setFormData({ ...formData, companyName: e.target.value })}\r\n                        className=\"p-3 border rounded-lg\"/>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block\">Email</label>\r\n                        <input type=\"email\"\r\n                        value={formData.email}\r\n                        onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                        className=\"p-3 border rounded-lg\"/>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block\">Password</label>\r\n                        <input type=\"password\"\r\n                        value={formData.password}\r\n                        onChange={(e) => setFormData({ ...formData, password: e.target.value })}\r\n                        className=\"p-3 border rounded-lg\"/>\r\n                    </div>\r\n                    <button type=\"submit\" disabled={loading} className=\"block mt-4 p-3 px-6 rounded-3xl shadow-xl border-blue-900 bg-indigo-900 text-yellow-300 font-bold border-2 hover:scale-105 hover:shadow-2xl transition-all duration-300 disabled:opacity-50 disabled:pointer-events-none\">Register</button>\r\n                </form>\r\n                <p className=\"mt-4 text-sm text-gray-600\">\r\n                    Already have an account? <Link href=\"/login\" className=\"text-indigo-900 font-medium\">Login</Link>\r\n                </p>\r\n            </div>\r\n        </main>\r\n    );\r\n}"],"names":[],"mappings":"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"}}]
}